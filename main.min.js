var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),BackGroup=function(t){function e(e,i){var r=t.call(this)||this;return r.init(e,i),r}return __extends(e,t),e.prototype.init=function(t,e){var i=new egret.Bitmap,r=RES.getRes("sheet_json.bone_png");i.texture=r,this.addChild(i);var n=t,s=e;i.width=2*r.textureWidth,i.height=2*r.textureHeight,i.width=n,i.height=s,i.fillMode=egret.BitmapFillMode.REPEAT;var o=new egret.Shape;o.graphics.beginFill(0),o.graphics.drawRect(0,0,n,s),o.graphics.endFill(),o.alpha=.6,this.addChild(o)},e}(egret.DisplayObjectContainer);__reflect(BackGroup.prototype,"BackGroup");var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.setProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI");var Main=function(t){function e(){var e=t.call(this)||this;return e.num=0,e.timerCount=30,e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){egret.lifecycle.addLifecycleListener(function(t){t.onUpdate=function(){}}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()},this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},e.prototype.onConfigComplete=function(t){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},e.prototype.onResourceLoadComplete=function(t){"preload"==t.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.createGameScene())},e.prototype.onItemLoadError=function(t){console.warn("Url:"+t.resItem.url+" has failed to load")},e.prototype.onResourceLoadError=function(t){console.warn("Group:"+t.groupName+" has failed to load"),this.onResourceLoadComplete(t)},e.prototype.onResourceProgress=function(t){"preload"==t.groupName&&this.loadingView.setProgress(t.itemsLoaded,t.itemsTotal)},e.prototype.createGameScene=function(){var t=this.stage.stageWidth,e=this.stage.stageHeight,i=new BackGroup(t,e);this.addChild(i),this.text=new MyText("你抓住了"+this.num+"个间谍",30,120),this.addChild(this.text),this.textTime=new MyText("倒计时:"+this.timerCount,30,220),this.addChild(this.textTime),this.jiandieIndex=Math.ceil(5*Math.random()),this.jiandie=new MyBitMap("sheet_json."+this.jiandieIndex+"_png",400,60),this.addChild(this.jiandie);var r=Math.ceil(5*Math.random()),n=Math.ceil(650*Math.random()+250),s=Math.ceil(320*Math.random());this.selectSpr=new MyBitMap("sheet_json."+r+"_png",s,n),this.addChild(this.selectSpr),this.selectSpr.touchEnabled=!0,this.selectSpr.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this),this.timer=new egret.Timer(1e3,this.timerCount),this.timer.addEventListener(egret.TimerEvent.TIMER,this.timerFun,this),this.timer.addEventListener(egret.TimerEvent.TIMER_COMPLETE,this.timerComplete,this),this.timer.start()},e.prototype.timerFun=function(){this.timerCount--,this.textTime.getText("倒计时:"+this.timerCount),this.selectSprIndex=Math.ceil(5*Math.random());var t=Math.ceil(650*Math.random()+250),e=Math.ceil(320*Math.random());this.selectSpr.setBit(e,t),this.selectSpr.setMap("sheet_json."+this.selectSprIndex+"_png")},e.prototype.timerComplete=function(){this.selectSpr.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this),this.gameOver=new egret.Sprite,this.gameOver.graphics.beginFill(0);var t=this.stage.stageWidth,e=this.stage.stageHeight;this.gameOver.graphics.drawRect(0,0,t,e),this.gameOver.graphics.endFill(),this.gameOver.alpha=.8,this.addChild(this.gameOver);var i=new egret.TextField;i.text="你抓住了"+this.num+"个间谍",i.size=40,i.y=e/4,i.width=t,i.fontFamily="KaiTi",i.textColor=16711680,i.bold=!0,i.textAlign=egret.HorizontalAlign.CENTER,this.gameOver.addChild(i);var r=new egret.TextField;r.text="重新开始",r.y=e/2,r.width=t,r.textAlign=egret.HorizontalAlign.CENTER,r.size=50,this.gameOver.addChild(r),r.touchEnabled=!0,r.addEventListener(egret.TouchEvent.TOUCH_TAP,this.reStart,this)},e.prototype.reStart=function(){this.removeChild(this.gameOver),this.timerCount=30,this.num=0,this.createGameScene()},e.prototype.onTap=function(t){console.log(this.jiandieIndex+":"+this.selectSprIndex),this.jiandieIndex==this.selectSprIndex?(this.num++,this.text.getText("你抓住了"+this.num+"个间谍"),this.jiandieIndex=Math.ceil(5*Math.random()),this.jiandie.setMap("sheet_json."+this.jiandieIndex+"_png")):(this.num--,this.text.getText("你抓住了"+this.num+"个间谍"))},e}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var MyBitMap=function(t){function e(e,i,r){var n=t.call(this)||this;return n._x=0,n._y=0,n._x=i,n._y=r,n.init(e,n._x,n._y),n}return __extends(e,t),e.prototype.setBit=function(t,e){this.spr.x=t,this.spr.y=e},e.prototype.setMap=function(t){var e=RES.getRes(t);this.spr.texture=e,this.spr.width=1.4*e.textureWidth,this.spr.height=1.4*e.textureHeight},e.prototype.init=function(t,e,i){this.spr=new egret.Bitmap;var r=RES.getRes(t);this.spr.texture=r,this.spr.x=e,this.spr.y=i,this.spr.width=1.4*r.textureWidth,this.spr.height=1.4*r.textureHeight,this.addChild(this.spr)},e}(egret.Sprite);__reflect(MyBitMap.prototype,"MyBitMap");var MyText=function(t){function e(e,i,r){var n=t.call(this)||this;return n._x=0,n._y=0,n._x=i,n._y=r,n.init(e,n._x,n._y),n}return __extends(e,t),e.prototype.getText=function(t){this.text.text=t},e.prototype.init=function(t,e,i){this.text=new egret.TextField,this.text.text=t,this.text.x=e,this.text.y=i,this.text.size=40,this.addChild(this.text)},e}(egret.DisplayObjectContainer);__reflect(MyText.prototype,"MyText");